{"version":3,"sources":["assets\\script\\room\\joinroom.js"],"names":["require","io","cc","Class","Component","properties","roomID","type","Label","Pass","onLoad","join_room","PlayerInfo","director","getScene","getChildByName","getComponent","RoomInfos","uid","string","pass","fetch","method","headers","Accept","then","response","json","data","id","Player1","body","JSON","stringify","console","log","rid","loadScene","Player2","start"],"mappings":"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","sourceRoot":"/","sourcesContent":["const { io } = require(\"socket.io-client\");\r\n// const fetch = require('node-fetch')\r\ncc.Class({\r\n  extends: cc.Component,\r\n\r\n  properties: {\r\n    roomID: {\r\n      default: null,\r\n      type: cc.Label,\r\n    },\r\n    Pass: {\r\n      default: null,\r\n      type: cc.Label,\r\n    },\r\n  },\r\n\r\n  onLoad() {},\r\n  join_room() {\r\n    let PlayerInfo = cc.director\r\n      .getScene()\r\n      .getChildByName(\"PlayerInfo\")\r\n      .getComponent(\"PlayerInfo\");\r\n    let RoomInfos = cc.director\r\n      .getScene()\r\n      .getChildByName(\"RoomInfos\")\r\n      .getComponent(\"RoomInfos\");\r\n    let uid = PlayerInfo.uid;\r\n    let roomID = this.roomID.string;\r\n    let pass = this.Pass.string;\r\n    fetch(\"https://chinese-chess-vnp.herokuapp.com/api/room/\" + roomID, {\r\n      method: \"GET\",\r\n      headers: {\r\n        Accept: \"application/json\",\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n    })\r\n      .then((response) => response.json())\r\n      .then((data) => {\r\n        if (data.data.id == roomID) {\r\n          if (data.data.Player1 == null) {\r\n            fetch(\r\n              \"https://chinese-chess-vnp.herokuapp.com/api/room/\" + roomID,\r\n              {\r\n                method: \"PATCH\",\r\n                headers: {\r\n                  Accept: \"application/json\",\r\n                  \"Content-Type\": \"application/json\",\r\n                },\r\n                body: JSON.stringify({ Player1: uid }),\r\n              }\r\n            )\r\n              .then((response) => response.json())\r\n              .then((data) => {\r\n                console.log(data);\r\n                RoomInfos.rid = roomID;\r\n                cc.director.loadScene(\"room\");\r\n              });\r\n          } else if (data.data.Player2 == null) {\r\n            fetch(\r\n              \"https://chinese-chess-vnp.herokuapp.com/api/room/\" + roomID,\r\n              {\r\n                method: \"PATCH\",\r\n                headers: {\r\n                  Accept: \"application/json\",\r\n                  \"Content-Type\": \"application/json\",\r\n                },\r\n                body: JSON.stringify({ Player2: uid }),\r\n              }\r\n            )\r\n              .then((response) => response.json())\r\n              .then((data) => {\r\n                console.log(data);\r\n                RoomInfos.rid = roomID;\r\n                cc.director.loadScene(\"room\");\r\n              });\r\n          } else {\r\n            console.log(\"Roomfull!\");\r\n          }\r\n        }\r\n      });\r\n  },\r\n  start() {},\r\n\r\n  // update (dt) {},\r\n});\r\n"]}