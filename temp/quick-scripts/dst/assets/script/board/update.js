
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/script/board/update.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '077bfbFx0tAEKtrDKRzdXD9', 'update');
// script/board/update.js

"use strict";

var _axios_connection = require("../axios_connection");

var _socket_connection = require("../socket_connection");

// Learn cc.Class:
//  - https://docs.cocos.com/creator/manual/en/scripting/class.html
// Learn Attribute:
//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html
// Learn life-cycle callbacks:
//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html
// import * as io from "socket.io-client";
// let socket = io.connect('http://localhost:3000/');\
cc.Class({
  "extends": cc.Component,
  properties: {
    movecodelist: {
      "default": null,
      type: cc.Label
    },
    place: {
      "default": null,
      type: cc.Node
    },
    redchess: {
      "default": null,
      type: cc.Node
    },
    blackchess: {
      "default": null,
      type: cc.Node
    },
    deadredchess: {
      "default": null,
      type: cc.Node
    },
    deadblackchess: {
      "default": null,
      type: cc.Node
    },
    map: {
      "default": null,
      type: cc.Node
    },
    movelist: [],
    rid: {
      "default": null,
      type: cc.Label
    }
  },
  onLoad: function onLoad() {},
  updateall: function updateall() {// let map = this.map.getComponent("boardinfo");
    // list += JSON.stringify(map.movecode[map.movecode.length - 1]) + "\n";
  },
  start: function start() {},
  update: function update(dt) {
    var _this = this;

    if (dt === void 0) {
      dt = 10000;
    }

    var PlayerInfo = cc.director.getScene().getChildByName("PlayerInfo").getComponent("PlayerInfo");
    var rid = this.rid.string;
    var redchess = this.redchess;
    var redc = redchess.getChildren();
    var blackchess = this.blackchess;
    var blackc = blackchess.getChildren();
    var map = this.map.getComponent("boardinfo");
    var deadredchess = this.deadredchess;
    var deadblackchess = this.deadblackchess;
    var movecodelist = this.movecodelist;
    (0, _socket_connection.receivedchessPosition)().then(function (data) {
      for (var j = 0; j < redc.length; j++) {
        if (redc[j].name == data[data.length - 1].name && (redc[j].x != data[data.length - 1].x || redc[j].y != data[data.length - 1].y || redc[j].x != data[data.length - 1].x && redc[j].y != data[data.length - 1].y)) {
          //move chess
          cc.tween(redc[j]).delay(0.1).to(0.125, {
            position: cc.v2(data[data.length - 1].xed, data[data.length - 1].yed + 5),
            scale: 1.1
          }).delay(0.125).to(0.5, {
            position: cc.v2(data[data.length - 1].x, data[data.length - 1].y + 15),
            scale: 1.3
          }, {
            easing: "backIn"
          }).delay(0.125).to(0.125, {
            position: cc.v2(data[data.length - 1].x, data[data.length - 1].y),
            scale: 1
          }).start();
          (0, _axios_connection.getroombyID)(rid).then(function (data) {
            if (data.data.Player1 == PlayerInfo.uid) {
              redchess.pauseSystemEvents(true);
              blackchess.pauseSystemEvents(true);
            }

            if (data.data.Player2 == PlayerInfo.uid) {
              redchess.pauseSystemEvents(true);
              blackchess.resumeSystemEvents(true);
            }
          }); // redchess.pauseSystemEvents(true);
          // blackchess.resumeSystemEvents(true);

          break;
        }
      }

      for (var k = 0; k < blackc.length; k++) {
        if (blackc[k].name == data[data.length - 1].name && (blackc[k].x != data[data.length - 1].x || blackc[k].y != data[data.length - 1].y || blackc[k].x != data[data.length - 1].x && blackc[k].y != data[data.length - 1].y)) {
          //move chess
          cc.tween(blackc[k]).delay(0.1).to(0.125, {
            position: cc.v2(data[data.length - 1].xed, data[data.length - 1].yed + 5),
            scale: 1.1
          }).delay(0.125).to(0.5, {
            position: cc.v2(data[data.length - 1].x, data[data.length - 1].y + 15),
            scale: 1.3
          }, {
            easing: "backIn"
          }).delay(0.125).to(0.125, {
            position: cc.v2(data[data.length - 1].x, data[data.length - 1].y),
            scale: 1
          }).start();
          (0, _axios_connection.getroombyID)(rid).then(function (data) {
            if (data.data.Player1 == PlayerInfo.uid) {
              redchess.resumeSystemEvents(true);
              blackchess.pauseSystemEvents(true);
            }

            if (data.data.Player2 == PlayerInfo.uid) {
              redchess.pauseSystemEvents(true);
              blackchess.pauseSystemEvents(true);
            }
          }); // blackchess.pauseSystemEvents(true);
          // redchess.resumeSystemEvents(true);

          break;
        }
      }

      if (_this.movelist.length == 0 || _this.movelist[_this.movelist.length - 1] !== JSON.stringify(data[data.length - 1])) {
        _this.movelist.push(JSON.stringify(data[data.length - 1]));
      }

      movecodelist.string = _this.movelist;
    })["catch"](function () {
      console.log("Promise Rejected");
    });
    (0, _socket_connection.receiveddeadchess)().then(function (data) {
      for (var j = 0; j < redc.length; j++) {
        if (redc[j].name == data.name) {
          map.countreddead++; // redc[j].setScale(0.8, 0.8);

          cc.tween(redc[j]).delay(1).to(0, {
            position: cc.v2(187.5 - map.countreddead * map.chesssize, 0)
          }).call(function () {
            _this.node.pauseSystemEvents(true);

            _this.node.parent = deadredchess;
          }).start(); // redc[j].anchorX = 1;
          // redc[j].anchorY = 0.5;
          // redc[j].y = 0;
          // redc[j].x = 187.5 - map.countreddead * map.chesssize;
          // redc[j].pauseSystemEvents(true);
          // redc[j].parent = deadredchess;
        }
      }

      for (var k = 0; k < blackc.length; k++) {
        if (blackc[k].name == data.name) {
          map.countblackdead++;
          cc.tween(blackc[k]).delay(1).to(0, {
            position: cc.v2(-187.5 + map.countblackdead * map.chesssize, 0)
          }).call(function () {
            _this.node.pauseSystemEvents(true);

            _this.node.parent = deadblackchess;
          }).start(); // blackc[k].anchorX = 0;
          // blackc[k].anchorY = 0.5;
          // blackc[k].y = 0;
          // blackc[k].x = -187.5 + map.countblackdead * map.chesssize;
          // blackc[k].pauseSystemEvents(true);
          // blackc[k].parent = deadblackchess;
        }
      }
    })["catch"](function () {
      console.log("Promise Rejected");
    });
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0XFxib2FyZFxcdXBkYXRlLmpzIl0sIm5hbWVzIjpbImNjIiwiQ2xhc3MiLCJDb21wb25lbnQiLCJwcm9wZXJ0aWVzIiwibW92ZWNvZGVsaXN0IiwidHlwZSIsIkxhYmVsIiwicGxhY2UiLCJOb2RlIiwicmVkY2hlc3MiLCJibGFja2NoZXNzIiwiZGVhZHJlZGNoZXNzIiwiZGVhZGJsYWNrY2hlc3MiLCJtYXAiLCJtb3ZlbGlzdCIsInJpZCIsIm9uTG9hZCIsInVwZGF0ZWFsbCIsInN0YXJ0IiwidXBkYXRlIiwiZHQiLCJQbGF5ZXJJbmZvIiwiZGlyZWN0b3IiLCJnZXRTY2VuZSIsImdldENoaWxkQnlOYW1lIiwiZ2V0Q29tcG9uZW50Iiwic3RyaW5nIiwicmVkYyIsImdldENoaWxkcmVuIiwiYmxhY2tjIiwidGhlbiIsImRhdGEiLCJqIiwibGVuZ3RoIiwibmFtZSIsIngiLCJ5IiwidHdlZW4iLCJkZWxheSIsInRvIiwicG9zaXRpb24iLCJ2MiIsInhlZCIsInllZCIsInNjYWxlIiwiZWFzaW5nIiwiUGxheWVyMSIsInVpZCIsInBhdXNlU3lzdGVtRXZlbnRzIiwiUGxheWVyMiIsInJlc3VtZVN5c3RlbUV2ZW50cyIsImsiLCJKU09OIiwic3RyaW5naWZ5IiwicHVzaCIsImNvbnNvbGUiLCJsb2ciLCJjb3VudHJlZGRlYWQiLCJjaGVzc3NpemUiLCJjYWxsIiwibm9kZSIsInBhcmVudCIsImNvdW50YmxhY2tkZWFkIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQVFBOztBQUNBOztBQVRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFTQUEsRUFBRSxDQUFDQyxLQUFILENBQVM7QUFDUCxhQUFTRCxFQUFFLENBQUNFLFNBREw7QUFHUEMsRUFBQUEsVUFBVSxFQUFFO0FBQ1ZDLElBQUFBLFlBQVksRUFBRTtBQUNaLGlCQUFTLElBREc7QUFFWkMsTUFBQUEsSUFBSSxFQUFFTCxFQUFFLENBQUNNO0FB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RCxXQUFLLElBQUlpQyxDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHdEIsTUFBTSxDQUFDSSxNQUEzQixFQUFtQ2tCLENBQUMsRUFBcEMsRUFBd0M7QUFDdEMsWUFBSXRCLE1BQU0sQ0FBQ3NCLENBQUQsQ0FBTixDQUFVakIsSUFBVixJQUFrQkgsSUFBSSxDQUFDRyxJQUEzQixFQUFpQztBQUMvQnJCLFVBQUFBLEdBQUcsQ0FBQ2lELGNBQUo7QUFDQTlELFVBQUFBLEVBQUUsQ0FBQ3FDLEtBQUgsQ0FBU1IsTUFBTSxDQUFDc0IsQ0FBRCxDQUFmLEVBQ0diLEtBREgsQ0FDUyxDQURULEVBRUdDLEVBRkgsQ0FFTSxDQUZOLEVBRVM7QUFDTEMsWUFBQUEsUUFBUSxFQUFFeEMsRUFBRSxDQUFDeUMsRUFBSCxDQUFNLENBQUMsS0FBRCxHQUFTNUIsR0FBRyxDQUFDaUQsY0FBSixHQUFxQmpELEdBQUcsQ0FBQzZDLFNBQXhDLEVBQW1ELENBQW5EO0FBREwsV0FGVCxFQUtHQyxJQUxILENBS1EsWUFBTTtBQUNWLFlBQUEsS0FBSSxDQUFDQyxJQUFMLENBQVVaLGlCQUFWLENBQTRCLElBQTVCOztBQUNBLFlBQUEsS0FBSSxDQUFDWSxJQUFMLENBQVVDLE1BQVYsR0FBbUJqRCxjQUFuQjtBQUNELFdBUkgsRUFTR00sS0FUSCxHQUYrQixDQWEvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDRDtBQUNGO0FBQ0YsS0EvQ0gsV0FnRFMsWUFBWTtBQUNqQnFDLE1BQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLGtCQUFaO0FBQ0QsS0FsREg7QUFtREQ7QUExT00sQ0FBVCIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsiLy8gTGVhcm4gY2MuQ2xhc3M6XHJcbi8vICAtIGh0dHBzOi8vZG9jcy5jb2Nvcy5jb20vY3JlYXRvci9tYW51YWwvZW4vc2NyaXB0aW5nL2NsYXNzLmh0bWxcclxuLy8gTGVhcm4gQXR0cmlidXRlOlxyXG4vLyAgLSBodHRwczovL2RvY3MuY29jb3MuY29tL2NyZWF0b3IvbWFudWFsL2VuL3NjcmlwdGluZy9yZWZlcmVuY2UvYXR0cmlidXRlcy5odG1sXHJcbi8vIExlYXJuIGxpZmUtY3ljbGUgY2FsbGJhY2tzOlxyXG4vLyAgLSBodHRwczovL2RvY3MuY29jb3MuY29tL2NyZWF0b3IvbWFudWFsL2VuL3NjcmlwdGluZy9saWZlLWN5Y2xlLWNhbGxiYWNrcy5odG1sXHJcbi8vIGltcG9ydCAqIGFzIGlvIGZyb20gXCJzb2NrZXQuaW8tY2xpZW50XCI7XHJcbi8vIGxldCBzb2NrZXQgPSBpby5jb25uZWN0KCdodHRwOi8vbG9jYWxob3N0OjMwMDAvJyk7XFxcclxuaW1wb3J0IHsgZ2V0cm9vbWJ5SUQgfSBmcm9tIFwiLi4vYXhpb3NfY29ubmVjdGlvblwiO1xyXG5pbXBvcnQge1xyXG4gIHJlY2VpdmVkY2hlc3NQb3NpdGlvbixcclxuICByZWNlaXZlZGRlYWRjaGVzcyxcclxuICByZWNlaXZlZHJvb21JRCxcclxuICBzZW5kY2hlc3NQb3NpdGlvbixcclxufSBmcm9tIFwiLi4vc29ja2V0X2Nvbm5lY3Rpb25cIjtcclxuXHJcbmNjLkNsYXNzKHtcclxuICBleHRlbmRzOiBjYy5Db21wb25lbnQsXHJcblxyXG4gIHByb3BlcnRpZXM6IHtcclxuICAgIG1vdmVjb2RlbGlzdDoge1xyXG4gICAgICBkZWZhdWx0OiBudWxsLFxyXG4gICAgICB0eXBlOiBjYy5MYWJlbCxcclxuICAgIH0sXHJcbiAgICBwbGFjZToge1xyXG4gICAgICBkZWZhdWx0OiBudWxsLFxyXG4gICAgICB0eXBlOiBjYy5Ob2RlLFxyXG4gICAgfSxcclxuICAgIHJlZGNoZXNzOiB7XHJcbiAgICAgIGRlZmF1bHQ6IG51bGwsXHJcbiAgICAgIHR5cGU6IGNjLk5vZGUsXHJcbiAgICB9LFxyXG4gICAgYmxhY2tjaGVzczoge1xyXG4gICAgICBkZWZhdWx0OiBudWxsLFxyXG4gICAgICB0eXBlOiBjYy5Ob2RlLFxyXG4gICAgfSxcclxuICAgIGRlYWRyZWRjaGVzczoge1xyXG4gICAgICBkZWZhdWx0OiBudWxsLFxyXG4gICAgICB0eXBlOiBjYy5Ob2RlLFxyXG4gICAgfSxcclxuICAgIGRlYWRibGFja2NoZXNzOiB7XHJcbiAgICAgIGRlZmF1bHQ6IG51bGwsXHJcbiAgICAgIHR5cGU6IGNjLk5vZGUsXHJcbiAgICB9LFxyXG4gICAgbWFwOiB7XHJcbiAgICAgIGRlZmF1bHQ6IG51bGwsXHJcbiAgICAgIHR5cGU6IGNjLk5vZGUsXHJcbiAgICB9LFxyXG4gICAgbW92ZWxpc3Q6IFtdLFxyXG4gICAgcmlkOiB7XHJcbiAgICAgIGRlZmF1bHQ6IG51bGwsXHJcbiAgICAgIHR5cGU6IGNjLkxhYmVsLFxyXG4gICAgfSxcclxuICB9LFxyXG5cclxuICBvbkxvYWQoKSB7fSxcclxuICB1cGRhdGVhbGwoKSB7XHJcbiAgICAvLyBsZXQgbWFwID0gdGhpcy5tYXAuZ2V0Q29tcG9uZW50KFwiYm9hcmRpbmZvXCIpO1xyXG4gICAgLy8gbGlzdCArPSBKU09OLnN0cmluZ2lmeShtYXAubW92ZWNvZGVbbWFwLm1vdmVjb2RlLmxlbmd0aCAtIDFdKSArIFwiXFxuXCI7XHJcbiAgfSxcclxuICBzdGFydCgpIHt9LFxyXG4gIHVwZGF0ZShkdCA9IDEwMDAwKSB7XHJcbiAgICBsZXQgUGxheWVySW5mbyA9IGNjLmRpcmVjdG9yXHJcbiAgICAgIC5nZXRTY2VuZSgpXHJcbiAgICAgIC5nZXRDaGlsZEJ5TmFtZShcIlBsYXllckluZm9cIilcclxuICAgICAgLmdldENvbXBvbmVudChcIlBsYXllckluZm9cIik7XHJcbiAgICB2YXIgcmlkID0gdGhpcy5yaWQuc3RyaW5nO1xyXG4gICAgdmFyIHJlZGNoZXNzID0gdGhpcy5yZWRjaGVzcztcclxuICAgIHZhciByZWRjID0gcmVkY2hlc3MuZ2V0Q2hpbGRyZW4oKTtcclxuICAgIHZhciBibGFja2NoZXNzID0gdGhpcy5ibGFja2NoZXNzO1xyXG4gICAgdmFyIGJsYWNrYyA9IGJsYWNrY2hlc3MuZ2V0Q2hpbGRyZW4oKTtcclxuICAgIGxldCBtYXAgPSB0aGlzLm1hcC5nZXRDb21wb25lbnQoXCJib2FyZGluZm9cIik7XHJcbiAgICBsZXQgZGVhZHJlZGNoZXNzID0gdGhpcy5kZWFkcmVkY2hlc3M7XHJcbiAgICBsZXQgZGVhZGJsYWNrY2hlc3MgPSB0aGlzLmRlYWRibGFja2NoZXNzO1xyXG4gICAgdmFyIG1vdmVjb2RlbGlzdCA9IHRoaXMubW92ZWNvZGVsaXN0O1xyXG5cclxuICAgIHJlY2VpdmVkY2hlc3NQb3NpdGlvbigpXHJcbiAgICAgIC50aGVuKChkYXRhKSA9PiB7XHJcbiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCByZWRjLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgIHJlZGNbal0ubmFtZSA9PSBkYXRhW2RhdGEubGVuZ3RoIC0gMV0ubmFtZSAmJlxyXG4gICAgICAgICAgICAocmVkY1tqXS54ICE9IGRhdGFbZGF0YS5sZW5ndGggLSAxXS54IHx8XHJcbiAgICAgICAgICAgICAgcmVkY1tqXS55ICE9IGRhdGFbZGF0YS5sZW5ndGggLSAxXS55IHx8XHJcbiAgICAgICAgICAgICAgKHJlZGNbal0ueCAhPSBkYXRhW2RhdGEubGVuZ3RoIC0gMV0ueCAmJlxyXG4gICAgICAgICAgICAgICAgcmVkY1tqXS55ICE9IGRhdGFbZGF0YS5sZW5ndGggLSAxXS55KSlcclxuICAgICAgICAgICkge1xyXG4gICAgICAgICAgICAvL21vdmUgY2hlc3NcclxuICAgICAgICAgICAgY2MudHdlZW4ocmVkY1tqXSlcclxuICAgICAgICAgICAgICAuZGVsYXkoMC4xKVxyXG4gICAgICAgICAgICAgIC50bygwLjEyNSwge1xyXG4gICAgICAgICAgICAgICAgcG9zaXRpb246IGNjLnYyKFxyXG4gICAgICAgICAgICAgICAgICBkYXRhW2RhdGEubGVuZ3RoIC0gMV0ueGVkLFxyXG4gICAgICAgICAgICAgICAgICBkYXRhW2RhdGEubGVuZ3RoIC0gMV0ueWVkICsgNVxyXG4gICAgICAgICAgICAgICAgKSxcclxuICAgICAgICAgICAgICAgIHNjYWxlOiAxLjEsXHJcbiAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAuZGVsYXkoMC4xMjUpXHJcbiAgICAgICAgICAgICAgLnRvKFxyXG4gICAgICAgICAgICAgICAgMC41LFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICBwb3NpdGlvbjogY2MudjIoXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YVtkYXRhLmxlbmd0aCAtIDFdLngsXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YVtkYXRhLmxlbmd0aCAtIDFdLnkgKyAxNVxyXG4gICAgICAgICAgICAgICAgICApLFxyXG4gICAgICAgICAgICAgICAgICBzY2FsZTogMS4zLFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHsgZWFzaW5nOiBcImJhY2tJblwiIH1cclxuICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICAgLmRlbGF5KDAuMTI1KVxyXG4gICAgICAgICAgICAgIC50bygwLjEyNSwge1xyXG4gICAgICAgICAgICAgICAgcG9zaXRpb246IGNjLnYyKFxyXG4gICAgICAgICAgICAgICAgICBkYXRhW2RhdGEubGVuZ3RoIC0gMV0ueCxcclxuICAgICAgICAgICAgICAgICAgZGF0YVtkYXRhLmxlbmd0aCAtIDFdLnlcclxuICAgICAgICAgICAgICAgICksXHJcbiAgICAgICAgICAgICAgICBzY2FsZTogMSxcclxuICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgIC5zdGFydCgpO1xyXG5cclxuICAgICAgICAgICAgZ2V0cm9vbWJ5SUQocmlkKS50aGVuKChkYXRhKSA9PiB7XHJcbiAgICAgICAgICAgICAgaWYgKGRhdGEuZGF0YS5QbGF5ZXIxID09IFBsYXllckluZm8udWlkKSB7XHJcbiAgICAgICAgICAgICAgICByZWRjaGVzcy5wYXVzZVN5c3RlbUV2ZW50cyh0cnVlKTtcclxuICAgICAgICAgICAgICAgIGJsYWNrY2hlc3MucGF1c2VTeXN0ZW1FdmVudHModHJ1ZSk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIGlmIChkYXRhLmRhdGEuUGxheWVyMiA9PSBQbGF5ZXJJbmZvLnVpZCkge1xyXG4gICAgICAgICAgICAgICAgcmVkY2hlc3MucGF1c2VTeXN0ZW1FdmVudHModHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICBibGFja2NoZXNzLnJlc3VtZVN5c3RlbUV2ZW50cyh0cnVlKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAvLyByZWRjaGVzcy5wYXVzZVN5c3RlbUV2ZW50cyh0cnVlKTtcclxuICAgICAgICAgICAgLy8gYmxhY2tjaGVzcy5yZXN1bWVTeXN0ZW1FdmVudHModHJ1ZSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKHZhciBrID0gMDsgayA8IGJsYWNrYy5sZW5ndGg7IGsrKykge1xyXG4gICAgICAgICAgaWYgKFxyXG4gICAgICAgICAgICBibGFja2Nba10ubmFtZSA9PSBkYXRhW2RhdGEubGVuZ3RoIC0gMV0ubmFtZSAmJlxyXG4gICAgICAgICAgICAoYmxhY2tjW2tdLnggIT0gZGF0YVtkYXRhLmxlbmd0aCAtIDFdLnggfHxcclxuICAgICAgICAgICAgICBibGFja2Nba10ueSAhPSBkYXRhW2RhdGEubGVuZ3RoIC0gMV0ueSB8fFxyXG4gICAgICAgICAgICAgIChibGFja2Nba10ueCAhPSBkYXRhW2RhdGEubGVuZ3RoIC0gMV0ueCAmJlxyXG4gICAgICAgICAgICAgICAgYmxhY2tjW2tdLnkgIT0gZGF0YVtkYXRhLmxlbmd0aCAtIDFdLnkpKVxyXG4gICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgIC8vbW92ZSBjaGVzc1xyXG4gICAgICAgICAgICBjYy50d2VlbihibGFja2Nba10pXHJcbiAgICAgICAgICAgICAgLmRlbGF5KDAuMSlcclxuICAgICAgICAgICAgICAudG8oMC4xMjUsIHtcclxuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBjYy52MihcclxuICAgICAgICAgICAgICAgICAgZGF0YVtkYXRhLmxlbmd0aCAtIDFdLnhlZCxcclxuICAgICAgICAgICAgICAgICAgZGF0YVtkYXRhLmxlbmd0aCAtIDFdLnllZCArIDVcclxuICAgICAgICAgICAgICAgICksXHJcbiAgICAgICAgICAgICAgICBzY2FsZTogMS4xLFxyXG4gICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgLmRlbGF5KDAuMTI1KVxyXG4gICAgICAgICAgICAgIC50byhcclxuICAgICAgICAgICAgICAgIDAuNSxcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgcG9zaXRpb246IGNjLnYyKFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGFbZGF0YS5sZW5ndGggLSAxXS54LFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGFbZGF0YS5sZW5ndGggLSAxXS55ICsgMTVcclxuICAgICAgICAgICAgICAgICAgKSxcclxuICAgICAgICAgICAgICAgICAgc2NhbGU6IDEuMyxcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB7IGVhc2luZzogXCJiYWNrSW5cIiB9XHJcbiAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgIC5kZWxheSgwLjEyNSlcclxuICAgICAgICAgICAgICAudG8oMC4xMjUsIHtcclxuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBjYy52MihcclxuICAgICAgICAgICAgICAgICAgZGF0YVtkYXRhLmxlbmd0aCAtIDFdLngsXHJcbiAgICAgICAgICAgICAgICAgIGRhdGFbZGF0YS5sZW5ndGggLSAxXS55XHJcbiAgICAgICAgICAgICAgICApLFxyXG4gICAgICAgICAgICAgICAgc2NhbGU6IDEsXHJcbiAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAuc3RhcnQoKTtcclxuICAgICAgICAgICAgZ2V0cm9vbWJ5SUQocmlkKS50aGVuKChkYXRhKSA9PiB7XHJcbiAgICAgICAgICAgICAgaWYgKGRhdGEuZGF0YS5QbGF5ZXIxID09IFBsYXllckluZm8udWlkKSB7XHJcbiAgICAgICAgICAgICAgICByZWRjaGVzcy5yZXN1bWVTeXN0ZW1FdmVudHModHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICBibGFja2NoZXNzLnBhdXNlU3lzdGVtRXZlbnRzKHRydWUpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBpZiAoZGF0YS5kYXRhLlBsYXllcjIgPT0gUGxheWVySW5mby51aWQpIHtcclxuICAgICAgICAgICAgICAgIHJlZGNoZXNzLnBhdXNlU3lzdGVtRXZlbnRzKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgYmxhY2tjaGVzcy5wYXVzZVN5c3RlbUV2ZW50cyh0cnVlKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAvLyBibGFja2NoZXNzLnBhdXNlU3lzdGVtRXZlbnRzKHRydWUpO1xyXG4gICAgICAgICAgICAvLyByZWRjaGVzcy5yZXN1bWVTeXN0ZW1FdmVudHModHJ1ZSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoXHJcbiAgICAgICAgICB0aGlzLm1vdmVsaXN0Lmxlbmd0aCA9PSAwIHx8XHJcbiAgICAgICAgICB0aGlzLm1vdmVsaXN0W3RoaXMubW92ZWxpc3QubGVuZ3RoIC0gMV0gIT09XHJcbiAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KGRhdGFbZGF0YS5sZW5ndGggLSAxXSlcclxuICAgICAgICApIHtcclxuICAgICAgICAgIHRoaXMubW92ZWxpc3QucHVzaChKU09OLnN0cmluZ2lmeShkYXRhW2RhdGEubGVuZ3RoIC0gMV0pKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbW92ZWNvZGVsaXN0LnN0cmluZyA9IHRoaXMubW92ZWxpc3Q7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJQcm9taXNlIFJlamVjdGVkXCIpO1xyXG4gICAgICB9KTtcclxuICAgIHJlY2VpdmVkZGVhZGNoZXNzKClcclxuICAgICAgLnRoZW4oKGRhdGEpID0+IHtcclxuICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHJlZGMubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgIGlmIChyZWRjW2pdLm5hbWUgPT0gZGF0YS5uYW1lKSB7XHJcbiAgICAgICAgICAgIG1hcC5jb3VudHJlZGRlYWQrKztcclxuICAgICAgICAgICAgLy8gcmVkY1tqXS5zZXRTY2FsZSgwLjgsIDAuOCk7XHJcbiAgICAgICAgICAgIGNjLnR3ZWVuKHJlZGNbal0pXHJcbiAgICAgICAgICAgICAgLmRlbGF5KDEpXHJcbiAgICAgICAgICAgICAgLnRvKDAsIHtcclxuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBjYy52MigxODcuNSAtIG1hcC5jb3VudHJlZGRlYWQgKiBtYXAuY2hlc3NzaXplLCAwKSxcclxuICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgIC5jYWxsKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMubm9kZS5wYXVzZVN5c3RlbUV2ZW50cyh0cnVlKTtcclxuICAgICAgICAgICAgICAgIHRoaXMubm9kZS5wYXJlbnQgPSBkZWFkcmVkY2hlc3M7XHJcbiAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAuc3RhcnQoKTtcclxuXHJcbiAgICAgICAgICAgIC8vIHJlZGNbal0uYW5jaG9yWCA9IDE7XHJcbiAgICAgICAgICAgIC8vIHJlZGNbal0uYW5jaG9yWSA9IDAuNTtcclxuICAgICAgICAgICAgLy8gcmVkY1tqXS55ID0gMDtcclxuICAgICAgICAgICAgLy8gcmVkY1tqXS54ID0gMTg3LjUgLSBtYXAuY291bnRyZWRkZWFkICogbWFwLmNoZXNzc2l6ZTtcclxuICAgICAgICAgICAgLy8gcmVkY1tqXS5wYXVzZVN5c3RlbUV2ZW50cyh0cnVlKTtcclxuICAgICAgICAgICAgLy8gcmVkY1tqXS5wYXJlbnQgPSBkZWFkcmVkY2hlc3M7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgYmxhY2tjLmxlbmd0aDsgaysrKSB7XHJcbiAgICAgICAgICBpZiAoYmxhY2tjW2tdLm5hbWUgPT0gZGF0YS5uYW1lKSB7XHJcbiAgICAgICAgICAgIG1hcC5jb3VudGJsYWNrZGVhZCsrO1xyXG4gICAgICAgICAgICBjYy50d2VlbihibGFja2Nba10pXHJcbiAgICAgICAgICAgICAgLmRlbGF5KDEpXHJcbiAgICAgICAgICAgICAgLnRvKDAsIHtcclxuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBjYy52MigtMTg3LjUgKyBtYXAuY291bnRibGFja2RlYWQgKiBtYXAuY2hlc3NzaXplLCAwKSxcclxuICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgIC5jYWxsKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMubm9kZS5wYXVzZVN5c3RlbUV2ZW50cyh0cnVlKTtcclxuICAgICAgICAgICAgICAgIHRoaXMubm9kZS5wYXJlbnQgPSBkZWFkYmxhY2tjaGVzcztcclxuICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgIC5zdGFydCgpO1xyXG5cclxuICAgICAgICAgICAgLy8gYmxhY2tjW2tdLmFuY2hvclggPSAwO1xyXG4gICAgICAgICAgICAvLyBibGFja2Nba10uYW5jaG9yWSA9IDAuNTtcclxuICAgICAgICAgICAgLy8gYmxhY2tjW2tdLnkgPSAwO1xyXG4gICAgICAgICAgICAvLyBibGFja2Nba10ueCA9IC0xODcuNSArIG1hcC5jb3VudGJsYWNrZGVhZCAqIG1hcC5jaGVzc3NpemU7XHJcbiAgICAgICAgICAgIC8vIGJsYWNrY1trXS5wYXVzZVN5c3RlbUV2ZW50cyh0cnVlKTtcclxuICAgICAgICAgICAgLy8gYmxhY2tjW2tdLnBhcmVudCA9IGRlYWRibGFja2NoZXNzO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIlByb21pc2UgUmVqZWN0ZWRcIik7XHJcbiAgICAgIH0pO1xyXG4gIH0sXHJcbn0pO1xyXG4iXX0=