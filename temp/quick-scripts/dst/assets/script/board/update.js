
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/script/board/update.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '077bfbFx0tAEKtrDKRzdXD9', 'update');
// script/board/update.js

"use strict";

var _axios_connection = require("../axios_connection");

var _socket_connection = require("../socket_connection");

// Learn cc.Class:
//  - https://docs.cocos.com/creator/manual/en/scripting/class.html
// Learn Attribute:
//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html
// Learn life-cycle callbacks:
//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html
// import * as io from "socket.io-client";
// let socket = io.connect('http://localhost:3000/');\
cc.Class({
  "extends": cc.Component,
  properties: {
    movecodelist: {
      "default": null,
      type: cc.Label
    },
    place: {
      "default": null,
      type: cc.Node
    },
    redchess: {
      "default": null,
      type: cc.Node
    },
    blackchess: {
      "default": null,
      type: cc.Node
    },
    deadredchess: {
      "default": null,
      type: cc.Node
    },
    deadblackchess: {
      "default": null,
      type: cc.Node
    },
    map: {
      "default": null,
      type: cc.Node
    },
    movelist: [],
    rid: {
      "default": null,
      type: cc.Label
    }
  },
  onLoad: function onLoad() {},
  updateall: function updateall() {// let map = this.map.getComponent("boardinfo");
    // list += JSON.stringify(map.movecode[map.movecode.length - 1]) + "\n";
  },
  start: function start() {},
  update: function update(dt) {
    var _this = this;

    if (dt === void 0) {
      dt = 10000;
    }

    var PlayerInfo = cc.director.getScene().getChildByName("PlayerInfo").getComponent("PlayerInfo");
    console.log(PlayerInfo.uid);
    var rid = this.rid.string;
    var redchess = this.redchess;
    var redc = redchess.getChildren();
    var blackchess = this.blackchess;
    var blackc = blackchess.getChildren();
    var map = this.map.getComponent("boardinfo");
    var deadredchess = this.deadredchess;
    var deadblackchess = this.deadblackchess;
    var movecodelist = this.movecodelist;
    (0, _socket_connection.receivedchessPosition)().then(function (data) {
      for (var j = 0; j < redc.length; j++) {
        if (redc[j].name == data[data.length - 1].name && (redc[j].x != data[data.length - 1].x || redc[j].y != data[data.length - 1].y)) {
          console.log(data[data.length - 1]);
          redc[j].x = data[data.length - 1].x;
          redc[j].y = data[data.length - 1].y;
          (0, _axios_connection.getroombyID)(rid).then(function (data) {
            if (data.data.Player1 == PlayerInfo.uid) {
              redchess.pauseSystemEvents(true);
              blackchess.pauseSystemEvents(true);
            }

            if (data.data.Player2 == PlayerInfo.uid) {
              redchess.pauseSystemEvents(true);
              blackchess.resumeSystemEvents(true);
            }
          }); // redchess.pauseSystemEvents(true);
          // blackchess.resumeSystemEvents(true);

          break;
        }
      }

      for (var k = 0; k < blackc.length; k++) {
        if (blackc[k].name == data[data.length - 1].name && (blackc[k].x != data[data.length - 1].x || blackc[k].y != data[data.length - 1].y)) {
          blackc[k].x = data[data.length - 1].x;
          blackc[k].y = data[data.length - 1].y;
          (0, _axios_connection.getroombyID)(rid).then(function (data) {
            if (data.data.Player1 == PlayerInfo.uid) {
              redchess.resumeSystemEvents(true);
              blackchess.pauseSystemEvents(true);
            }

            if (data.data.Player2 == PlayerInfo.uid) {
              redchess.pauseSystemEvents(true);
              blackchess.pauseSystemEvents(true);
            }
          }); // blackchess.pauseSystemEvents(true);
          // redchess.resumeSystemEvents(true);

          break;
        }
      }

      if (_this.movelist.length == 0 || _this.movelist[_this.movelist.length - 1] !== JSON.stringify(data[data.length - 1])) {
        _this.movelist.push(JSON.stringify(data[data.length - 1]));
      }

      movecodelist.string = _this.movelist;
    })["catch"](function () {
      console.log("Promise Rejected");
    });
    (0, _socket_connection.receiveddeadchess)().then(function (data) {
      for (var j = 0; j < redc.length; j++) {
        if (redc[j].name == data.name) {
          map.countreddead++; // redc[j].setScale(0.8, 0.8);

          redc[j].anchorX = 1;
          redc[j].anchorY = 0.5;
          redc[j].y = 0;
          redc[j].x = 187.5 - map.countreddead * map.chesssize;
          redc[j].pauseSystemEvents(true);
          redc[j].parent = deadredchess;
        }
      }

      for (var k = 0; k < blackc.length; k++) {
        if (blackc[k].name == data.name) {
          map.countblackdead++;
          blackc[k].anchorX = 0;
          blackc[k].anchorY = 0.5;
          blackc[k].y = 0;
          blackc[k].x = -187.5 + map.countblackdead * map.chesssize;
          blackc[k].pauseSystemEvents(true);
          blackc[k].parent = deadblackchess;
        }
      }
    })["catch"](function () {
      console.log("Promise Rejected");
    });
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0XFxib2FyZFxcdXBkYXRlLmpzIl0sIm5hbWVzIjpbImNjIiwiQ2xhc3MiLCJDb21wb25lbnQiLCJwcm9wZXJ0aWVzIiwibW92ZWNvZGVsaXN0IiwidHlwZSIsIkxhYmVsIiwicGxhY2UiLCJOb2RlIiwicmVkY2hlc3MiLCJibGFja2NoZXNzIiwiZGVhZHJlZGNoZXNzIiwiZGVhZGJsYWNrY2hlc3MiLCJtYXAiLCJtb3ZlbGlzdCIsInJpZCIsIm9uTG9hZCIsInVwZGF0ZWFsbCIsInN0YXJ0IiwidXBkYXRlIiwiZHQiLCJQbGF5ZXJJbmZvIiwiZGlyZWN0b3IiLCJnZXRTY2VuZSIsImdldENoaWxkQnlOYW1lIiwiZ2V0Q29tcG9uZW50IiwiY29uc29sZSIsImxvZyIsInVpZCIsInN0cmluZyIsInJlZGMiLCJnZXRDaGlsZHJlbiIsImJsYWNrYyIsInRoZW4iLCJkYXRhIiwiaiIsImxlbmd0aCIsIm5hbWUiLCJ4IiwieSIsIlBsYXllcjEiLCJwYXVzZVN5c3RlbUV2ZW50cyIsIlBsYXllcjIiLCJyZXN1bWVTeXN0ZW1FdmVudHMiLCJrIiwiSlNPTiIsInN0cmluZ2lmeSIsInB1c2giLCJjb3VudHJlZGRlYWQiLCJhbmNob3JYIiwiYW5jaG9yWSIsImNoZXNzc2l6ZSIsInBhcmVudCIsImNvdW50YmxhY2tkZWFkIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQVFBOztBQUNBOztBQVRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFTQUEsRUFBRSxDQUFDQyxLQUFILENBQVM7QUFDUCxhQUFTRCxFQUFFLENBQUNFLFNBREw7QUFHUEMsRUFBQUEsVUFBVSxFQUFFO0FBQ1ZDLElBQUFBLFlBQVksRUFBRTtBQUNaLGlCQUFTLElBREc7QUFFWkMsTUFBQUEsSUFBSSxFQUFFTCxFQUFFLENBQUNNO0FBRkcsS0FESjtBQUtWQyxJQUFBQSxLQUFLLEVBQUU7QUFDTCxpQkFBUyxJQURKO0FBRUxGLE1BQUFBLElB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MUI7QUFDQVgsVUFBQUEsSUFBSSxDQUFDSyxDQUFELENBQUosQ0FBUWlCLE1BQVIsR0FBaUJ6QyxZQUFqQjtBQUNEO0FBQ0Y7O0FBQ0QsV0FBSyxJQUFJaUMsQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsR0FBR1osTUFBTSxDQUFDSSxNQUEzQixFQUFtQ1EsQ0FBQyxFQUFwQyxFQUF3QztBQUN0QyxZQUFJWixNQUFNLENBQUNZLENBQUQsQ0FBTixDQUFVUCxJQUFWLElBQWtCSCxJQUFJLENBQUNHLElBQTNCLEVBQWlDO0FBQy9CeEIsVUFBQUEsR0FBRyxDQUFDd0MsY0FBSjtBQUNBckIsVUFBQUEsTUFBTSxDQUFDWSxDQUFELENBQU4sQ0FBVUssT0FBVixHQUFvQixDQUFwQjtBQUNBakIsVUFBQUEsTUFBTSxDQUFDWSxDQUFELENBQU4sQ0FBVU0sT0FBVixHQUFvQixHQUFwQjtBQUNBbEIsVUFBQUEsTUFBTSxDQUFDWSxDQUFELENBQU4sQ0FBVUwsQ0FBVixHQUFjLENBQWQ7QUFDQVAsVUFBQUEsTUFBTSxDQUFDWSxDQUFELENBQU4sQ0FBVU4sQ0FBVixHQUFjLENBQUMsS0FBRCxHQUFTekIsR0FBRyxDQUFDd0MsY0FBSixHQUFxQnhDLEdBQUcsQ0FBQ3NDLFNBQWhEO0FBQ0FuQixVQUFBQSxNQUFNLENBQUNZLENBQUQsQ0FBTixDQUFVSCxpQkFBVixDQUE0QixJQUE1QjtBQUNBVCxVQUFBQSxNQUFNLENBQUNZLENBQUQsQ0FBTixDQUFVUSxNQUFWLEdBQW1CeEMsY0FBbkI7QUFDRDtBQUNGO0FBQ0YsS0F6QkgsV0EwQlMsWUFBWTtBQUNqQmMsTUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVksa0JBQVo7QUFDRCxLQTVCSDtBQTZCRDtBQXZKTSxDQUFUIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyIvLyBMZWFybiBjYy5DbGFzczpcclxuLy8gIC0gaHR0cHM6Ly9kb2NzLmNvY29zLmNvbS9jcmVhdG9yL21hbnVhbC9lbi9zY3JpcHRpbmcvY2xhc3MuaHRtbFxyXG4vLyBMZWFybiBBdHRyaWJ1dGU6XHJcbi8vICAtIGh0dHBzOi8vZG9jcy5jb2Nvcy5jb20vY3JlYXRvci9tYW51YWwvZW4vc2NyaXB0aW5nL3JlZmVyZW5jZS9hdHRyaWJ1dGVzLmh0bWxcclxuLy8gTGVhcm4gbGlmZS1jeWNsZSBjYWxsYmFja3M6XHJcbi8vICAtIGh0dHBzOi8vZG9jcy5jb2Nvcy5jb20vY3JlYXRvci9tYW51YWwvZW4vc2NyaXB0aW5nL2xpZmUtY3ljbGUtY2FsbGJhY2tzLmh0bWxcclxuLy8gaW1wb3J0ICogYXMgaW8gZnJvbSBcInNvY2tldC5pby1jbGllbnRcIjtcclxuLy8gbGV0IHNvY2tldCA9IGlvLmNvbm5lY3QoJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMC8nKTtcXFxyXG5pbXBvcnQgeyBnZXRyb29tYnlJRCB9IGZyb20gXCIuLi9heGlvc19jb25uZWN0aW9uXCI7XHJcbmltcG9ydCB7XHJcbiAgcmVjZWl2ZWRjaGVzc1Bvc2l0aW9uLFxyXG4gIHJlY2VpdmVkZGVhZGNoZXNzLFxyXG4gIHJlY2VpdmVkcm9vbUlELFxyXG4gIHNlbmRjaGVzc1Bvc2l0aW9uLFxyXG59IGZyb20gXCIuLi9zb2NrZXRfY29ubmVjdGlvblwiO1xyXG5cclxuY2MuQ2xhc3Moe1xyXG4gIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcclxuXHJcbiAgcHJvcGVydGllczoge1xyXG4gICAgbW92ZWNvZGVsaXN0OiB7XHJcbiAgICAgIGRlZmF1bHQ6IG51bGwsXHJcbiAgICAgIHR5cGU6IGNjLkxhYmVsLFxyXG4gICAgfSxcclxuICAgIHBsYWNlOiB7XHJcbiAgICAgIGRlZmF1bHQ6IG51bGwsXHJcbiAgICAgIHR5cGU6IGNjLk5vZGUsXHJcbiAgICB9LFxyXG4gICAgcmVkY2hlc3M6IHtcclxuICAgICAgZGVmYXVsdDogbnVsbCxcclxuICAgICAgdHlwZTogY2MuTm9kZSxcclxuICAgIH0sXHJcbiAgICBibGFja2NoZXNzOiB7XHJcbiAgICAgIGRlZmF1bHQ6IG51bGwsXHJcbiAgICAgIHR5cGU6IGNjLk5vZGUsXHJcbiAgICB9LFxyXG4gICAgZGVhZHJlZGNoZXNzOiB7XHJcbiAgICAgIGRlZmF1bHQ6IG51bGwsXHJcbiAgICAgIHR5cGU6IGNjLk5vZGUsXHJcbiAgICB9LFxyXG4gICAgZGVhZGJsYWNrY2hlc3M6IHtcclxuICAgICAgZGVmYXVsdDogbnVsbCxcclxuICAgICAgdHlwZTogY2MuTm9kZSxcclxuICAgIH0sXHJcbiAgICBtYXA6IHtcclxuICAgICAgZGVmYXVsdDogbnVsbCxcclxuICAgICAgdHlwZTogY2MuTm9kZSxcclxuICAgIH0sXHJcbiAgICBtb3ZlbGlzdDogW10sXHJcbiAgICByaWQ6IHtcclxuICAgICAgZGVmYXVsdDogbnVsbCxcclxuICAgICAgdHlwZTogY2MuTGFiZWwsXHJcbiAgICB9LFxyXG4gIH0sXHJcblxyXG4gIG9uTG9hZCgpIHt9LFxyXG4gIHVwZGF0ZWFsbCgpIHtcclxuICAgIC8vIGxldCBtYXAgPSB0aGlzLm1hcC5nZXRDb21wb25lbnQoXCJib2FyZGluZm9cIik7XHJcbiAgICAvLyBsaXN0ICs9IEpTT04uc3RyaW5naWZ5KG1hcC5tb3ZlY29kZVttYXAubW92ZWNvZGUubGVuZ3RoIC0gMV0pICsgXCJcXG5cIjtcclxuICB9LFxyXG4gIHN0YXJ0KCkge30sXHJcbiAgdXBkYXRlKGR0ID0gMTAwMDApIHtcclxuICAgIGxldCBQbGF5ZXJJbmZvID0gY2MuZGlyZWN0b3JcclxuICAgICAgLmdldFNjZW5lKClcclxuICAgICAgLmdldENoaWxkQnlOYW1lKFwiUGxheWVySW5mb1wiKVxyXG4gICAgICAuZ2V0Q29tcG9uZW50KFwiUGxheWVySW5mb1wiKTtcclxuICAgIGNvbnNvbGUubG9nKFBsYXllckluZm8udWlkKTtcclxuICAgIHZhciByaWQgPSB0aGlzLnJpZC5zdHJpbmc7XHJcbiAgICB2YXIgcmVkY2hlc3MgPSB0aGlzLnJlZGNoZXNzO1xyXG4gICAgdmFyIHJlZGMgPSByZWRjaGVzcy5nZXRDaGlsZHJlbigpO1xyXG4gICAgdmFyIGJsYWNrY2hlc3MgPSB0aGlzLmJsYWNrY2hlc3M7XHJcbiAgICB2YXIgYmxhY2tjID0gYmxhY2tjaGVzcy5nZXRDaGlsZHJlbigpO1xyXG4gICAgbGV0IG1hcCA9IHRoaXMubWFwLmdldENvbXBvbmVudChcImJvYXJkaW5mb1wiKTtcclxuICAgIGxldCBkZWFkcmVkY2hlc3MgPSB0aGlzLmRlYWRyZWRjaGVzcztcclxuICAgIGxldCBkZWFkYmxhY2tjaGVzcyA9IHRoaXMuZGVhZGJsYWNrY2hlc3M7XHJcbiAgICB2YXIgbW92ZWNvZGVsaXN0ID0gdGhpcy5tb3ZlY29kZWxpc3Q7XHJcblxyXG4gICAgcmVjZWl2ZWRjaGVzc1Bvc2l0aW9uKClcclxuICAgICAgLnRoZW4oKGRhdGEpID0+IHtcclxuICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHJlZGMubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgIGlmIChcclxuICAgICAgICAgICAgcmVkY1tqXS5uYW1lID09IGRhdGFbZGF0YS5sZW5ndGggLSAxXS5uYW1lICYmXHJcbiAgICAgICAgICAgIChyZWRjW2pdLnggIT0gZGF0YVtkYXRhLmxlbmd0aCAtIDFdLnggfHxcclxuICAgICAgICAgICAgICByZWRjW2pdLnkgIT0gZGF0YVtkYXRhLmxlbmd0aCAtIDFdLnkpXHJcbiAgICAgICAgICApIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YVtkYXRhLmxlbmd0aCAtIDFdKTtcclxuICAgICAgICAgICAgcmVkY1tqXS54ID0gZGF0YVtkYXRhLmxlbmd0aCAtIDFdLng7XHJcbiAgICAgICAgICAgIHJlZGNbal0ueSA9IGRhdGFbZGF0YS5sZW5ndGggLSAxXS55O1xyXG4gICAgICAgICAgICBnZXRyb29tYnlJRChyaWQpLnRoZW4oKGRhdGEpID0+IHtcclxuICAgICAgICAgICAgICBpZiAoZGF0YS5kYXRhLlBsYXllcjEgPT0gUGxheWVySW5mby51aWQpIHtcclxuICAgICAgICAgICAgICAgIHJlZGNoZXNzLnBhdXNlU3lzdGVtRXZlbnRzKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgYmxhY2tjaGVzcy5wYXVzZVN5c3RlbUV2ZW50cyh0cnVlKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgaWYgKGRhdGEuZGF0YS5QbGF5ZXIyID09IFBsYXllckluZm8udWlkKSB7XHJcbiAgICAgICAgICAgICAgICByZWRjaGVzcy5wYXVzZVN5c3RlbUV2ZW50cyh0cnVlKTtcclxuICAgICAgICAgICAgICAgIGJsYWNrY2hlc3MucmVzdW1lU3lzdGVtRXZlbnRzKHRydWUpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIC8vIHJlZGNoZXNzLnBhdXNlU3lzdGVtRXZlbnRzKHRydWUpO1xyXG4gICAgICAgICAgICAvLyBibGFja2NoZXNzLnJlc3VtZVN5c3RlbUV2ZW50cyh0cnVlKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgYmxhY2tjLmxlbmd0aDsgaysrKSB7XHJcbiAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgIGJsYWNrY1trXS5uYW1lID09IGRhdGFbZGF0YS5sZW5ndGggLSAxXS5uYW1lICYmXHJcbiAgICAgICAgICAgIChibGFja2Nba10ueCAhPSBkYXRhW2RhdGEubGVuZ3RoIC0gMV0ueCB8fFxyXG4gICAgICAgICAgICAgIGJsYWNrY1trXS55ICE9IGRhdGFbZGF0YS5sZW5ndGggLSAxXS55KVxyXG4gICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgIGJsYWNrY1trXS54ID0gZGF0YVtkYXRhLmxlbmd0aCAtIDFdLng7XHJcbiAgICAgICAgICAgIGJsYWNrY1trXS55ID0gZGF0YVtkYXRhLmxlbmd0aCAtIDFdLnk7XHJcbiAgICAgICAgICAgIGdldHJvb21ieUlEKHJpZCkudGhlbigoZGF0YSkgPT4ge1xyXG4gICAgICAgICAgICAgIGlmIChkYXRhLmRhdGEuUGxheWVyMSA9PSBQbGF5ZXJJbmZvLnVpZCkge1xyXG4gICAgICAgICAgICAgICAgcmVkY2hlc3MucmVzdW1lU3lzdGVtRXZlbnRzKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgYmxhY2tjaGVzcy5wYXVzZVN5c3RlbUV2ZW50cyh0cnVlKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgaWYgKGRhdGEuZGF0YS5QbGF5ZXIyID09IFBsYXllckluZm8udWlkKSB7XHJcbiAgICAgICAgICAgICAgICByZWRjaGVzcy5wYXVzZVN5c3RlbUV2ZW50cyh0cnVlKTtcclxuICAgICAgICAgICAgICAgIGJsYWNrY2hlc3MucGF1c2VTeXN0ZW1FdmVudHModHJ1ZSk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgLy8gYmxhY2tjaGVzcy5wYXVzZVN5c3RlbUV2ZW50cyh0cnVlKTtcclxuICAgICAgICAgICAgLy8gcmVkY2hlc3MucmVzdW1lU3lzdGVtRXZlbnRzKHRydWUpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKFxyXG4gICAgICAgICAgdGhpcy5tb3ZlbGlzdC5sZW5ndGggPT0gMCB8fFxyXG4gICAgICAgICAgdGhpcy5tb3ZlbGlzdFt0aGlzLm1vdmVsaXN0Lmxlbmd0aCAtIDFdICE9PVxyXG4gICAgICAgICAgICBKU09OLnN0cmluZ2lmeShkYXRhW2RhdGEubGVuZ3RoIC0gMV0pXHJcbiAgICAgICAgKSB7XHJcbiAgICAgICAgICB0aGlzLm1vdmVsaXN0LnB1c2goSlNPTi5zdHJpbmdpZnkoZGF0YVtkYXRhLmxlbmd0aCAtIDFdKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG1vdmVjb2RlbGlzdC5zdHJpbmcgPSB0aGlzLm1vdmVsaXN0O1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiUHJvbWlzZSBSZWplY3RlZFwiKTtcclxuICAgICAgfSk7XHJcbiAgICByZWNlaXZlZGRlYWRjaGVzcygpXHJcbiAgICAgIC50aGVuKChkYXRhKSA9PiB7XHJcbiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCByZWRjLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICBpZiAocmVkY1tqXS5uYW1lID09IGRhdGEubmFtZSkge1xyXG4gICAgICAgICAgICBtYXAuY291bnRyZWRkZWFkKys7XHJcbiAgICAgICAgICAgIC8vIHJlZGNbal0uc2V0U2NhbGUoMC44LCAwLjgpO1xyXG4gICAgICAgICAgICByZWRjW2pdLmFuY2hvclggPSAxO1xyXG4gICAgICAgICAgICByZWRjW2pdLmFuY2hvclkgPSAwLjU7XHJcbiAgICAgICAgICAgIHJlZGNbal0ueSA9IDA7XHJcbiAgICAgICAgICAgIHJlZGNbal0ueCA9IDE4Ny41IC0gbWFwLmNvdW50cmVkZGVhZCAqIG1hcC5jaGVzc3NpemU7XHJcbiAgICAgICAgICAgIHJlZGNbal0ucGF1c2VTeXN0ZW1FdmVudHModHJ1ZSk7XHJcbiAgICAgICAgICAgIHJlZGNbal0ucGFyZW50ID0gZGVhZHJlZGNoZXNzO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKHZhciBrID0gMDsgayA8IGJsYWNrYy5sZW5ndGg7IGsrKykge1xyXG4gICAgICAgICAgaWYgKGJsYWNrY1trXS5uYW1lID09IGRhdGEubmFtZSkge1xyXG4gICAgICAgICAgICBtYXAuY291bnRibGFja2RlYWQrKztcclxuICAgICAgICAgICAgYmxhY2tjW2tdLmFuY2hvclggPSAwO1xyXG4gICAgICAgICAgICBibGFja2Nba10uYW5jaG9yWSA9IDAuNTtcclxuICAgICAgICAgICAgYmxhY2tjW2tdLnkgPSAwO1xyXG4gICAgICAgICAgICBibGFja2Nba10ueCA9IC0xODcuNSArIG1hcC5jb3VudGJsYWNrZGVhZCAqIG1hcC5jaGVzc3NpemU7XHJcbiAgICAgICAgICAgIGJsYWNrY1trXS5wYXVzZVN5c3RlbUV2ZW50cyh0cnVlKTtcclxuICAgICAgICAgICAgYmxhY2tjW2tdLnBhcmVudCA9IGRlYWRibGFja2NoZXNzO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIlByb21pc2UgUmVqZWN0ZWRcIik7XHJcbiAgICAgIH0pO1xyXG4gIH0sXHJcbn0pO1xyXG4iXX0=